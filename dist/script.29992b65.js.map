{"version":3,"sources":["Viewer.js","Colorbar.js","mandelbrot.js","script.js"],"names":["drawGrid","ctx","xmin","xmax","dx","ymin","ymax","dy","x","beginPath","moveTo","lineTo","closePath","stroke","y","module","exports","element","view","draw","status","min","undefined","max","width","clientWidth","height","clientHeight","canvas","document","createElement","style","cursor","touchAction","appendChild","getContext","fillStyle","strokeStyle","translate","scale","init","mtXY2IJ","getTransform","mtIJ2XY","invertSelf","updateMatrix","getXY","i","j","a","c","e","b","d","f","getScale","Math","sqrt","clampXY","p","clampScale","k","pointers","addEventListener","push","id","pointerId","si","offsetX","sj","offsetY","setShift","pt","find","ei","ej","di","dj","length","movingUpdate","movingUpdate2","fixTransform","pointerend","p0","p1","p0s","p0e","p1s","p1e","vsi","vsj","vei","vej","ad","bc","transform","cx","cy","update","window","deltaY","image","Image","drawCenter","save","resetTransform","ci","cj","lineWidth","restore","clearRect","drawImage","src","toDataURL","toFixed","info","HEX2RGB","r","g","colors","n","interpolate","x0","y0","x1","y1","get","floor","c0","c1","Colorbar","require","md","xn","yn","xn1","yn1","m","data","getImageData","cb","index","z","putImageData","Viewer","mandelbrot","vw","getElementById","str","innerHTML"],"mappings":";AAMA,IAAMA,EAAW,SAASC,EAAIC,EAAKC,EAAKC,EAAGC,EAAKC,EAAKC,GAChD,IAAA,IAAIC,EAAIN,EAAMM,GAAKL,EAAMK,GAAKJ,EACjCH,EAAIQ,YACJR,EAAIS,OAAOF,EAAEH,GACbJ,EAAIU,OAAOH,EAAEF,GACbL,EAAIW,YACJX,EAAIY,SAGD,IAAA,IAAIC,EAAIT,EAAMS,GAAKR,EAAMQ,GAAKP,EACjCN,EAAIQ,YACJR,EAAIS,OAAOR,EAAKY,GAChBb,EAAIU,OAAOR,EAAKW,GAChBb,EAAIW,YACJX,EAAIY,UAKNE,OAAOC,QAAU,SAASC,EAAQC,EAAKC,EAAKC,GAEtC,QAASF,EAAKV,IAAIU,EAAKV,EAAEa,SAAMC,GAC/B,QAASJ,EAAKV,IAAIU,EAAKV,EAAEe,SAAMD,GAC/B,QAASJ,EAAKJ,IAAII,EAAKJ,EAAEO,SAAMC,GAC/B,QAASJ,EAAKJ,IAAII,EAAKJ,EAAES,SAAMD,GAE9BE,IAAAA,EAAQP,EAAQQ,YAChBC,EAAST,EAAQU,aAEjBC,EAASC,SAASC,cAAc,UACtCF,EAAOJ,MAAQA,EACfI,EAAOF,OAASA,EAChBE,EAAOG,MAAMC,OAAS,YACtBJ,EAAOG,MAAME,YAAc,OAC3BhB,EAAQiB,YAAYN,GAEd3B,IAAAA,EAAM2B,EAAOO,WAAW,MAC9BlC,EAAImC,UAAY,wBAChBnC,EAAIoC,YAAc,wBAGlBpC,EAAIqC,UAAkB,GAARd,EAAsB,GAATE,GAG3BzB,EAAIsC,MAAMrB,EAAKqB,MAAMC,MAAOtB,EAAKqB,MAAMC,MAGvCvC,EAAIqC,WAAWpB,EAAKV,EAAEgC,MAAOtB,EAAKJ,EAAE0B,MAMhCC,IAAAA,EAAUxC,EAAIyC,eACdC,EAAU1C,EAAIyC,eAAeE,aAE3BC,EAAe,WACpBJ,EAAUxC,EAAIyC,eACdC,EAAU1C,EAAIyC,eAAeE,cAGxBE,EAAQ,SAASC,EAAEC,GAGjB,MAAA,CAACxC,EAFEmC,EAAQM,EAAIF,EAAIJ,EAAQO,EAAIF,EAAIL,EAAQQ,EAExCrC,EADA6B,EAAQS,EAAIL,EAAIJ,EAAQU,EAAIL,EAAIL,EAAQW,IAU7CC,EAAW,WACTC,OAAAA,KAAKC,KAAKhB,EAAQQ,EAAIR,EAAQQ,EAAIR,EAAQW,EAAIX,EAAQW,IAQxDM,EAAU,WACfb,IACMc,IAAAA,EAAIb,EAAc,GAARtB,EAAqB,GAATE,GAExBlB,EAAImD,EAAEnD,EACNM,EAAI6C,EAAE7C,EAEOQ,MAAdJ,EAAKV,EAAEa,KAAoBb,EAAIU,EAAKV,EAAEa,MAAKb,EAAIU,EAAKV,EAAEa,KACxCC,MAAdJ,EAAKV,EAAEe,KAAoBf,EAAIU,EAAKV,EAAEe,MAAKf,EAAIU,EAAKV,EAAEe,KACxCD,MAAdJ,EAAKJ,EAAEO,KAAoBP,EAAII,EAAKJ,EAAEO,MAAKP,EAAII,EAAKJ,EAAEO,KACxCC,MAAdJ,EAAKJ,EAAES,KAAoBT,EAAII,EAAKJ,EAAES,MAAKT,EAAII,EAAKJ,EAAES,KAEzDtB,EAAIqC,UAAUqB,EAAEnD,EAAIA,EAAGmD,EAAE7C,EAAIA,IAIxB8C,EAAa,SAASD,GAC3Bd,IAEIgB,IAAAA,EAAI,EAELN,IAAarC,EAAKqB,MAAMhB,MAC1BsC,EAAI3C,EAAKqB,MAAMhB,IAAMgC,KAGnBA,IAAarC,EAAKqB,MAAMlB,MAC1BwC,EAAI3C,EAAKqB,MAAMlB,IAAMkC,KAGtBtD,EAAIqC,UAAUqB,EAAEnD,EAAGmD,EAAE7C,GACrBb,EAAIsC,MAAMsB,EAAEA,GACZ5D,EAAIqC,WAAWqB,EAAEnD,GAAImD,EAAE7C,IASpBgD,EAAW,GAEflC,EAAOmC,iBAAiB,cAAc,SAASZ,GAC9CvB,EAAOG,MAAMC,OAAS,OAEtB8B,EAASE,KAAK,CACbC,GAAId,EAAEe,UACNC,GAAIhB,EAAEiB,QACNC,GAAIlB,EAAEmB,YAKFC,IAAAA,EAAW,SAASpB,GACnBqB,IAAAA,EAAKV,EAASW,KAAK,SAASd,GAC1BA,OAAAA,EAAEM,IAAMd,EAAEe,YAIlBM,EAAGE,GAAKvB,EAAEiB,QACVI,EAAGG,GAAKxB,EAAEmB,QAGVE,EAAGI,GAAKzB,EAAEiB,QAAUI,EAAGL,GACvBK,EAAGK,GAAK1B,EAAEmB,QAAUE,EAAGH,IAGxBzC,EAAOmC,iBAAiB,cAAc,SAASZ,GAExB,GAAnBW,EAASgB,OACH,CACP/B,EAAGI,EAAEiB,QACLpB,EAAGG,EAAEmB,SAGqB,GAAnBR,EAASgB,QACjBP,EAASpB,GACT4B,EAAajB,EAAS,GAAGc,GAAGd,EAAS,GAAGe,KAEb,GAAnBf,EAASgB,SACjBP,EAASpB,GACT6B,EAAclB,EAAS,GAAGA,EAAS,OAK/BmB,IA4CAC,EAAa,SAAS/B,IA5CP,WAEjBW,GAAmB,GAAnBA,EAASgB,OAAY,CAEjBK,IAAAA,EAAKrC,EAAMgB,EAAS,GAAGK,GAAGL,EAAS,GAAGO,IACtCe,EAAKtC,EAAMgB,EAAS,GAAGY,GAAGZ,EAAS,GAAGa,IAC5C1E,EAAIqC,UAAU8C,EAAG5E,EAAI2E,EAAG3E,EAAE4E,EAAGtE,EAAIqE,EAAGrE,QAE/B,GAAsB,GAAnBgD,EAASgB,OAAY,CAEvBO,IAAAA,EAAMvC,EAAMgB,EAAS,GAAGK,GAAGL,EAAS,GAAGO,IACvCiB,EAAMxC,EAAMgB,EAAS,GAAGY,GAAGZ,EAAS,GAAGa,IACvCY,EAAMzC,EAAMgB,EAAS,GAAGK,GAAGL,EAAS,GAAGO,IACvCmB,EAAM1C,EAAMgB,EAAS,GAAGY,GAAGZ,EAAS,GAAGa,IAE7C1E,EAAIqC,UAAUgD,EAAI9E,EAAG8E,EAAIxE,GAInB2E,IAAAA,EAAMF,EAAI/E,EAAI6E,EAAI7E,EAClBkF,EAAMH,EAAIzE,EAAIuE,EAAIvE,EAClB6E,EAAMH,EAAIhF,EAAI8E,EAAI9E,EAClBoF,EAAMJ,EAAI1E,EAAIwE,EAAIxE,EAClB+C,EAAI,GAAK4B,EAAMA,EAAMC,EAAMA,GAC3BG,EAAKF,EAAMF,EAAMG,EAAMF,EACvBI,EAAKF,EAAMH,EAAME,EAAMD,EAC7BzF,EAAI8F,UAAUF,EAAKhC,EAAGiC,EAAKjC,GAAIiC,EAAKjC,EAAGgC,EAAKhC,EAAG,EAAG,GAElD5D,EAAIqC,WAAWgD,EAAI9E,GAAI8E,EAAIxE,GAG3Bb,EAAIqC,UAAUgD,EAAI9E,EAAI6E,EAAI7E,EAAG8E,EAAIxE,EAAIuE,EAAIvE,GAGnCkF,IAAAA,EAAuB,IAAjBX,EAAI7E,EAAI+E,EAAI/E,GAClByF,EAAuB,IAAjBZ,EAAIvE,EAAIyE,EAAIzE,GACxB8C,EAAW,CAACpD,EAAEwF,EAAIlF,EAAEmF,IAGrBvC,IACAb,IAKAoC,GACAiB,IAEApC,EAAW,GAEXlC,EAAOG,MAAMC,OAAS,aAGvBmE,OAAOpC,iBAAiB,YAAYmB,GACpCiB,OAAOpC,iBAAiB,gBAAgBmB,GAMxCtD,EAAOmC,iBAAiB,QAAQ,SAASZ,GAGlCQ,IAAAA,EAAIb,EAAMK,EAAEiB,QAAQjB,EAAEmB,SACtBT,EAAIV,EAAEiD,OAAS,EAAI,IAAM,EAAI,IAEnCnG,EAAIqC,UAAUqB,EAAEnD,EAAEmD,EAAE7C,GACpBb,EAAIsC,MAAMsB,EAAEA,GACZ5D,EAAIqC,WAAWqB,EAAEnD,GAAGmD,EAAE7C,GAEtB8C,EAAWD,GACXD,IACAb,IACAqD,MAQKG,IAAAA,EAAQ,IAAIC,MAEZC,EAAa,WAClBtG,EAAIuG,OACJvG,EAAIwG,iBACJxG,EAAIoC,YAAc,wBAEZqE,IAAAA,EAAa,GAARlF,EACLmF,EAAc,GAATjF,EAEXzB,EAAI2G,UAAY,EAEhB3G,EAAIQ,YACJR,EAAIS,OAAOgG,EAAG,GAAGC,GACjB1G,EAAIU,OAAO+F,EAAG,GAAGC,GACjB1G,EAAIW,YACJX,EAAIY,SAEJZ,EAAIQ,YACJR,EAAIS,OAAOgG,EAAGC,EAAG,IACjB1G,EAAIU,OAAO+F,EAAGC,EAAG,IACjB1G,EAAIW,YACJX,EAAIY,SAEJZ,EAAI4G,WAaC9B,EAAe,SAASH,EAAGC,GAGhC5E,EAAIuG,OACJvG,EAAIwG,iBACJxG,EAAI6G,UAAU,EAAG,EAAGtF,EAAOE,GAE3BzB,EAAIqC,UAAUsC,EAAIC,GAClB5E,EAAI8G,UAAUV,EAAM,EAAE,EAAE7E,EAAME,EAAO,EAAE,EAAEF,EAAME,GAE/CzB,EAAI4G,UAEJN,KAIKvB,EAAgB,SAASG,EAAGC,GAGjCnF,EAAIuG,OACJvG,EAAIwG,iBACJxG,EAAI6G,UAAU,EAAG,EAAGtF,EAAOE,GAG3BzB,EAAIqC,UAAU6C,EAAGT,GAAGS,EAAGR,IAIjBc,IAAAA,EAAML,EAAGjB,GAAKgB,EAAGhB,GACjBuB,EAAMN,EAAGf,GAAKc,EAAGd,GACjBsB,EAAMP,EAAGV,GAAKS,EAAGT,GACjBkB,EAAMR,EAAGT,GAAKQ,EAAGR,GACjBd,EAAI,GAAK4B,EAAMA,EAAMC,EAAMA,GAC3BG,EAAKF,EAAMF,EAAMG,EAAMF,EACvBI,EAAKF,EAAMH,EAAME,EAAMD,EAC7BzF,EAAI8F,UAAUF,EAAKhC,EAAGiC,EAAKjC,GAAIiC,EAAKjC,EAAGgC,EAAKhC,EAAG,EAAG,GAElD5D,EAAIqC,WAAW6C,EAAGT,IAAIS,EAAGR,IAGzB1E,EAAIqC,UAAU6C,EAAGP,GAAGO,EAAGN,IAEvB5E,EAAI8G,UAAUV,EAAM,EAAE,EAAE7E,EAAME,EAAO,EAAE,EAAEF,EAAME,GAC/CzB,EAAI4G,UAEJN,KAGKL,EAAS,WAEdjG,EAAIuG,OACJvG,EAAIwG,iBACJxG,EAAI6G,UAAU,EAAG,EAAGtF,EAAOE,GAC3BzB,EAAI4G,UAGJ1F,EAAKlB,EAAIuB,EAAME,GA4Bf2E,EAAMW,IAAMpF,EAAOqF,YA7FP,WACZV,IACM5C,IAAAA,EAAIb,EAAc,GAARtB,EAAqB,GAATE,GACtBa,EAAQgB,IAEdnC,EAAO,KAAOuC,EAAEnD,EAAE0G,QAAQ,GAAK,SAAWvD,EAAE7C,EAAEoG,QAAQ,GAAK,aAAe3E,EAAM2E,QAAQ,GAAK,UA2F7FC,IAGDjB;;ACzXD,IAAMkB,EAAU,SAASlE,GAIjB,MAAA,CAACmE,GAHO,SAAJnE,IAAiB,GAGlBoE,GAFK,MAAJpE,IAAiB,EAEhBE,EADE,IAAJF,IAIXnC,OAAOC,QAAU,SAASK,EAAIE,EAAIgG,GAE3BC,IAAAA,EAAID,EAAOzC,OACX1E,GAAMmB,EAAMF,IAAQmG,EAAI,GAExBC,EAAc,SAASjH,EAAEkH,EAAGC,EAAGC,EAAGC,GAChC,OAACrH,EAAIkH,IAAOG,EAAKF,IAAOC,EAAKF,GAAMC,GAGtCG,KAAAA,IAAM,SAAStH,GAChBA,GAAAA,GAAKa,EAAK,OAAO+F,EAAQG,EAAO,IAChC/G,GAAAA,GAAKe,EAAK,OAAO6F,EAAQG,EAAOC,EAAE,IAE/BzE,IAAAA,EAAIS,KAAKuE,OAAOvH,EAAIa,GAAOjB,GAC3BsH,EAAKrG,EAAM0B,EAAI3C,EACf4H,EAAKZ,EAAQG,EAAOxE,IACpBkF,EAAKb,EAAQG,EAAOxE,EAAE,IAKrB,MAAA,CAACsE,EAHEI,EAAYjH,EAAEkH,EAAGM,EAAGX,EAAEK,EAAKtH,EAAG6H,EAAGZ,GAGjCC,EAFAG,EAAYjH,EAAEkH,EAAGM,EAAGV,EAAEI,EAAKtH,EAAG6H,EAAGX,GAE/BlE,EADFqE,EAAYjH,EAAEkH,EAAGM,EAAG5E,EAAEsE,EAAKtH,EAAG6H,EAAG7E;;AC3B7C,IAAM8E,EAAWC,QAAQ,iBAEnBC,EAAK,SAAS5H,EAAEM,GAIjB,IAHAuH,IAAAA,EAAK,EACLC,EAAK,EAEDvF,EAAE,EAAGA,EAAE,IAAKA,IAAI,CACjBwF,IACAC,EAAM,EAAIH,EAAKC,EAAKxH,EAIvBuH,IAHHA,EAFYA,EAAKA,EAAKC,EAAKA,EAAK9H,GAKxB6H,GAFRC,EAAKE,GAEaF,EAAK,EAAG,OAAO,IAAMvF,EAGjC,OAAA,GAIRhC,OAAOC,QAAU,SAASf,EAAIuB,EAAME,GAQ/B,IANE+G,IAAAA,EAAIxI,EAAIyC,eAAeE,aAEvB8F,EAAOzI,EAAI0I,aAAa,EAAG,EAAGnH,EAAOE,GAErCkH,EAAK,IAAIV,EAAS,EAAE,GAAG,CAAC,EAAS,SAAS,SAAS,QAAS,IAE1DlF,EAAE,EAAGA,EAAEtB,EAAQsB,IAClB,IAAA,IAAID,EAAE,EAAGA,EAAEvB,EAAOuB,IAAI,CACnB8F,IAAAA,EAA0B,GAAjB9F,EAAIC,EAAIxB,GAEjBhB,EAAIiI,EAAExF,EAAIF,EAAI0F,EAAEvF,EAAIF,EAAIyF,EAAEtF,EAC1BrC,EAAI2H,EAAErF,EAAIL,EAAI0F,EAAEpF,EAAIL,EAAIyF,EAAEnF,EAC1BwF,EAAIV,EAAG5H,EAAEM,GAEToC,EAAI0F,EAAGd,IAAIgB,EAAI,IAErBJ,EAAKA,KAAKG,GAAS3F,EAAEmE,EACrBqB,EAAKA,KAAKG,EAAM,GAAK3F,EAAEoE,EACvBoB,EAAKA,KAAKG,EAAM,GAAK3F,EAAEE,EACvBsF,EAAKA,KAAKG,EAAM,GAAK,IAIvB5I,EAAI8I,aAAaL,EAAM,EAAG;;AC5C3B,IAAMM,EAASb,QAAQ,eACjBc,EAAad,QAAQ,mBAErBe,EAAK,IAAIF,EAAOnH,SAASsH,eAAe,UAAU,CAEvD3I,EAAG,CACFgC,MAAO,GACPnB,KAAM,EACNE,IAAK,GAGNT,EAAG,CACF0B,KAAM,EACNnB,KAAM,IACNE,IAAK,KAGNgB,MAAO,CACNC,KAAM,IACNnB,IAAK,IACLE,IAAK,MAGL,SAAStB,EAAIuB,EAAME,GAEpBuH,EAAWhJ,EAAIuB,EAAME,IAEpB,SAAS0H,GAEVvH,SAASsH,eAAe,UAAUE,UAAYD","file":"script.29992b65.js","sourceRoot":"..\\src","sourcesContent":["/*\r\n\tViewer\r\n\t2020/10/26 新規作成\r\n*/\r\n\r\n//XY目盛り\r\nconst drawGrid = function(ctx,xmin,xmax,dx,ymin,ymax,dy){\r\n\tfor(let x = xmin; x <= xmax; x += dx){\r\n\t\tctx.beginPath();\r\n\t\tctx.moveTo(x,ymin);\r\n\t\tctx.lineTo(x,ymax);\r\n\t\tctx.closePath();\r\n\t\tctx.stroke();\r\n\t}\r\n\t\r\n\tfor(let y = ymin; y <= ymax; y += dy){\r\n\t\tctx.beginPath();\r\n\t\tctx.moveTo(xmin,y);\r\n\t\tctx.lineTo(xmax,y);\r\n\t\tctx.closePath();\r\n\t\tctx.stroke();\r\n\t}\r\n};\r\n\r\n//表示画面\r\nmodule.exports = function(element,view,draw,status){\r\n\t\r\n\tif(!(\"min\" in view.x)) view.x.min = undefined;\r\n\tif(!(\"max\" in view.x)) view.x.max = undefined;\r\n\tif(!(\"min\" in view.y)) view.y.min = undefined;\r\n\tif(!(\"max\" in view.y)) view.y.max = undefined;\r\n\t\r\n\tconst width = element.clientWidth;\r\n\tconst height = element.clientHeight;\r\n\t\r\n\tconst canvas = document.createElement(\"canvas\");\r\n\tcanvas.width = width;\r\n\tcanvas.height = height;\r\n\tcanvas.style.cursor = \"crosshair\";\r\n\tcanvas.style.touchAction = \"none\";\r\n\telement.appendChild(canvas);\r\n\t\r\n\tconst ctx = canvas.getContext(\"2d\");\r\n\tctx.fillStyle = \"rgba(255,255,255,1.0)\";\r\n\tctx.strokeStyle = \"rgba(255,255,255,1.0)\";\r\n\t\r\n\t//原点をcanvas中心に移動\r\n\tctx.translate(width * 0.5, height * 0.5);\r\n\t\r\n\t//縮尺[px/1]、Y軸を上下逆転\r\n\tctx.scale(view.scale.init, -view.scale.init);\r\n\t\r\n\t//画面中心の座標(X,Y)を設定\r\n\tctx.translate(-view.x.init, -view.y.init);\r\n\t\r\n\t//--------------------------------------------------\r\n\t//座標変換\r\n\t//--------------------------------------------------\r\n\t\r\n\tlet mtXY2IJ = ctx.getTransform();\r\n\tlet mtIJ2XY = ctx.getTransform().invertSelf();\r\n\t\r\n\tconst updateMatrix = function(){\r\n\t\tmtXY2IJ = ctx.getTransform();\r\n\t\tmtIJ2XY = ctx.getTransform().invertSelf();\r\n\t};\r\n\t\r\n\tconst getXY = function(i,j){\r\n\t\tconst x = mtIJ2XY.a * i + mtIJ2XY.c * j + mtIJ2XY.e;\r\n\t\tconst y = mtIJ2XY.b * i + mtIJ2XY.d * j + mtIJ2XY.f;\r\n\t\treturn {x,y};\r\n\t};\r\n\t\r\n\tconst getIJ = function(x,y){\r\n\t\tconst i = mtXY2IJ.a * x + mtXY2IJ.c * y + mtXY2IJ.e;\r\n\t\tconst j = mtXY2IJ.b * x + mtXY2IJ.d * y + mtXY2IJ.f;\r\n\t\treturn {i,j};\r\n\t};\r\n\t\r\n\tconst getScale = function(){\r\n\t\treturn Math.sqrt(mtXY2IJ.a * mtXY2IJ.a + mtXY2IJ.b * mtXY2IJ.b);\r\n\t};\r\n\t\r\n\t//--------------------------------------------------\r\n\t//移動拡大制約\r\n\t//--------------------------------------------------\r\n\t\r\n\t//画面中心がxyの範囲内に収まるように移動\r\n\tconst clampXY = function(){\r\n\t\tupdateMatrix();\r\n\t\tconst p = getXY(width * 0.5,height * 0.5);\r\n\t\t\r\n\t\tlet x = p.x;\r\n\t\tlet y = p.y;\r\n\t\t\r\n\t\tif(view.x.min != undefined && x < view.x.min) x = view.x.min;\r\n\t\tif(view.x.max != undefined && x > view.x.max) x = view.x.max;\r\n\t\tif(view.y.min != undefined && y < view.y.min) y = view.y.min;\r\n\t\tif(view.y.max != undefined && y > view.y.max) y = view.y.max;\r\n\t\t\r\n\t\tctx.translate(p.x - x, p.y - y);\r\n\t};\r\n\t\r\n\t//p: 拡大中心位置(XY座標)\r\n\tconst clampScale = function(p){\r\n\t\tupdateMatrix();\r\n\t\t\r\n\t\tlet k = 1;\r\n\t\t\r\n\t\tif(getScale() > view.scale.max){\r\n\t\t\tk = view.scale.max / getScale();\r\n\t\t};\r\n\t\t\t\r\n\t\tif(getScale() < view.scale.min){\r\n\t\t\tk = view.scale.min / getScale();\r\n\t\t};\r\n\t\t\r\n\t\tctx.translate(p.x, p.y);\r\n\t\tctx.scale(k,k);\r\n\t\tctx.translate(-p.x, -p.y);\r\n\t};\r\n\t\r\n\t//--------------------------------------------------\r\n\t//ポインターイベント\r\n\t//--------------------------------------------------\r\n\t\r\n\t//動作中のポインター\r\n\tlet mouse = null;\t//クリックしていない状態のマウス位置（e.pointerId=1となるが、pointersには含めない)\r\n\tlet pointers = [];\t//クリックまたはタップされたポインターの位置\r\n\t\r\n\tcanvas.addEventListener(\"pointerdown\",function(e){\r\n\t\tcanvas.style.cursor = \"move\";\r\n\t\t\r\n\t\tpointers.push({\r\n\t\t\tid: e.pointerId,\r\n\t\t\tsi: e.offsetX,\r\n\t\t\tsj: e.offsetY,\r\n\t\t});\r\n\t});\r\n\t\r\n\t//該当するポインターの状態を更新する\r\n\tconst setShift = function(e){\r\n\t\tconst pt = pointers.find(function(p){\r\n\t\t\treturn p.id == e.pointerId;\r\n\t\t});\r\n\t\t\r\n\t\t//最新位置\r\n\t\tpt.ei = e.offsetX;\r\n\t\tpt.ej = e.offsetY;\r\n\t\t\r\n\t\t//移動量\r\n\t\tpt.di = e.offsetX - pt.si;\r\n\t\tpt.dj = e.offsetY - pt.sj;\r\n\t};\r\n\t\r\n\tcanvas.addEventListener(\"pointermove\",function(e){\r\n\t\t\r\n\t\tif(pointers.length == 0){\r\n\t\t\tmouse = {\r\n\t\t\t\ti: e.offsetX,\r\n\t\t\t\tj: e.offsetY,\r\n\t\t\t};\r\n\t\t\t\r\n\t\t}else if(pointers.length == 1){\r\n\t\t\tsetShift(e);\r\n\t\t\tmovingUpdate(pointers[0].di,pointers[0].dj);\r\n\t\t\t\r\n\t\t}else if(pointers.length == 2){\r\n\t\t\tsetShift(e);\r\n\t\t\tmovingUpdate2(pointers[0],pointers[1]);\r\n\t\t}\r\n\t});\r\n\t\r\n\t//座標変換を確定させる\r\n\tconst fixTransform = function(){\r\n\t\t\r\n\t\tif(pointers.length == 1){\r\n\t\t\t//p0がp1に一致するように平行移動\r\n\t\t\tconst p0 = getXY(pointers[0].si,pointers[0].sj);\r\n\t\t\tconst p1 = getXY(pointers[0].ei,pointers[0].ej);\r\n\t\t\tctx.translate(p1.x - p0.x,p1.y - p0.y);\r\n\t\t\t\r\n\t\t}else if(pointers.length == 2){\r\n\t\t\t//p0sがp0e、p1sがp1eに一致するように平行移動回転拡大\r\n\t\t\tconst p0s = getXY(pointers[0].si,pointers[0].sj);\r\n\t\t\tconst p0e = getXY(pointers[0].ei,pointers[0].ej);\r\n\t\t\tconst p1s = getXY(pointers[1].si,pointers[1].sj);\r\n\t\t\tconst p1e = getXY(pointers[1].ei,pointers[1].ej);\r\n\t\t\t\r\n\t\t\tctx.translate(p0e.x, p0e.y);\r\n\t\t\t\r\n\t\t\t//p0を中心としてvsがveに一致するように回転拡大する座標変換\r\n\t\t\t//移動前のp0→p1ベクトルvs、移動後のp0→p1ベクトルve\r\n\t\t\tconst vsi = p1s.x - p0s.x;\r\n\t\t\tconst vsj = p1s.y - p0s.y;\r\n\t\t\tconst vei = p1e.x - p0e.x;\r\n\t\t\tconst vej = p1e.y - p0e.y;\r\n\t\t\tconst k = 1 / (vsi * vsi + vsj * vsj);\r\n\t\t\tconst ad = vei * vsi + vej * vsj;\r\n\t\t\tconst bc = vej * vsi - vei * vsj;\r\n\t\t\tctx.transform(ad * k, bc * k, -bc * k, ad * k, 0, 0);\r\n\t\t\t\r\n\t\t\tctx.translate(-p0e.x, -p0e.y);\r\n\r\n\t\t\t//p0の位置を合わせる\r\n\t\t\tctx.translate(p0e.x - p0s.x, p0e.y - p0s.y);\r\n\t\t\t\r\n\t\t\t//ズーム制約\r\n\t\t\tconst cx = (p0s.x + p1s.x) * 0.5;\r\n\t\t\tconst cy = (p0s.y + p1s.y) * 0.5;\r\n\t\t\tclampScale({x:cx, y:cy});\r\n\t\t}\r\n\t\t\r\n\t\tclampXY();\r\n\t\tupdateMatrix();\r\n\t}\r\n\t\r\n\t//ポインター終了時の動作\r\n\tconst pointerend = function(e){\r\n\t\tfixTransform();\r\n\t\tupdate();\r\n\t\t\r\n\t\tpointers = [];\r\n\t\t\r\n\t\tcanvas.style.cursor = \"crosshair\";\r\n\t};\r\n\t\r\n\twindow.addEventListener(\"pointerup\",pointerend);\r\n\twindow.addEventListener(\"pointercancel\",pointerend);\r\n\t\r\n\t//--------------------------------------------------\r\n\t//マウスホイールイベント(PC専用)\r\n\t//--------------------------------------------------\r\n\t\r\n\tcanvas.addEventListener(\"wheel\",function(e){\r\n\t\t\r\n\t\t//マウスの位置pを中心にk倍する\r\n\t\tconst p = getXY(e.offsetX,e.offsetY);\r\n\t\tconst k = e.deltaY < 0 ? 1.4 : 1 / 1.4;\r\n\t\t\r\n\t\tctx.translate(p.x,p.y);\r\n\t\tctx.scale(k,k);\r\n\t\tctx.translate(-p.x,-p.y);\r\n\t\t\r\n\t\tclampScale(p);\r\n\t\tclampXY();\r\n\t\tupdateMatrix();\r\n\t\tupdate();\r\n\t});\r\n\t\r\n\t//--------------------------------------------------\r\n\t//描画\r\n\t//--------------------------------------------------\r\n\t\r\n\t//画面に表示された画像(移動中に表示させる)\r\n\tconst image = new Image();\r\n\t\r\n\tconst drawCenter = function(){\r\n\t\tctx.save();\r\n\t\tctx.resetTransform();\r\n\t\tctx.strokeStyle = \"rgba(255,255,255,1.0)\";\r\n\t\t\r\n\t\tconst ci = width * 0.5;\r\n\t\tconst cj = height * 0.5;\r\n\t\t\r\n\t\tctx.lineWidth = 1.0;\r\n\t\t\r\n\t\tctx.beginPath();\r\n\t\tctx.moveTo(ci-10,cj);\r\n\t\tctx.lineTo(ci+10,cj);\r\n\t\tctx.closePath();\r\n\t\tctx.stroke();\r\n\t\t\r\n\t\tctx.beginPath();\r\n\t\tctx.moveTo(ci,cj-10);\r\n\t\tctx.lineTo(ci,cj+10);\r\n\t\tctx.closePath();\r\n\t\tctx.stroke();\r\n\t\t\r\n\t\tctx.restore();\r\n\t};\r\n\t\r\n\t//status表示\r\n\tconst info = function(){\r\n\t\tdrawCenter();\r\n\t\tconst p = getXY(width * 0.5,height * 0.5);\r\n\t\tconst scale = getScale();\r\n\r\n\t\tstatus(\"X=\" + p.x.toFixed(8) + \"<br>Y=\" + p.y.toFixed(8) + \"<br>Scale=\" + scale.toFixed(1) + \"[px/1]\");\r\n\t};\r\n\t\r\n\t//平行移動用(簡略化版)\r\n\tconst movingUpdate = function(di,dj){\r\n\t\t\r\n\t\t//IJ座標系に直して処理\r\n\t\tctx.save();\r\n\t\tctx.resetTransform();\r\n\t\tctx.clearRect(0, 0, width, height);\r\n\t\t\r\n\t\tctx.translate(di, dj);\r\n\t\tctx.drawImage(image,0,0,width,height,0,0,width,height);\r\n\t\t\r\n\t\tctx.restore();\r\n\t\t\r\n\t\tdrawCenter();\r\n\t};\r\n\t\r\n\t//ピンチインアウト版\r\n\tconst movingUpdate2 = function(p0,p1){\r\n\t\t\r\n\t\t//IJ座標系に直して処理\r\n\t\tctx.save();\r\n\t\tctx.resetTransform();\r\n\t\tctx.clearRect(0, 0, width, height);\r\n\t\t\r\n\t\t//p0sがp0e、p1sがp1eに一致するように平行移動回転拡大\r\n\t\tctx.translate(p0.ei,p0.ej);\r\n\t\t\r\n\t\t//p0を中心としてvsがveに一致するように回転拡大する座標変換\r\n\t\t//移動前のp0→p1ベクトルvs、移動後のp0→p1ベクトルve\r\n\t\tconst vsi = p1.si - p0.si;\r\n\t\tconst vsj = p1.sj - p0.sj;\r\n\t\tconst vei = p1.ei - p0.ei;\r\n\t\tconst vej = p1.ej - p0.ej;\r\n\t\tconst k = 1 / (vsi * vsi + vsj * vsj);\r\n\t\tconst ad = vei * vsi + vej * vsj;\r\n\t\tconst bc = vej * vsi - vei * vsj;\r\n\t\tctx.transform(ad * k, bc * k, -bc * k, ad * k, 0, 0);\r\n\r\n\t\tctx.translate(-p0.ei,-p0.ej);\r\n\r\n\t\t//p0の位置を合わせる\r\n\t\tctx.translate(p0.di,p0.dj);\r\n\t\t\r\n\t\tctx.drawImage(image,0,0,width,height,0,0,width,height);\r\n\t\tctx.restore();\r\n\t\t\r\n\t\tdrawCenter();\r\n\t};\r\n\t\r\n\tconst update = function(){\r\n\t\t//IJ座標系に直して全画面消去\r\n\t\tctx.save();\r\n\t\tctx.resetTransform();\r\n\t\tctx.clearRect(0, 0, width, height);\r\n\t\tctx.restore();\r\n\t\t\r\n\t\t//XY座標で描画\r\n\t\tdraw(ctx,width,height);\r\n\t\t\r\n\t\t//X,Y目盛り\r\n//\t\tctx.lineWidth = 0.5 / getScale();\r\n//\t\tdrawGrid(ctx,view.x.min,view.x.max,1,view.y.min,view.y.max,1);\r\n\t\t\r\n\t\t//IJ座標系に直して描画(文字サイズをピクセル単位で指定するため)\r\n\t\t/*\r\n\t\tlet mt = ctx.getTransform();\r\n\t\tconst getIJ = function(x,y){\r\n\t\t\tconst i = mt.a * x + mt.c * y + mt.e;\r\n\t\t\tconst j = mt.b * x + mt.d * y + mt.f;\r\n\t\t\treturn {i,j};\r\n\t\t};\r\n\t\t\r\n\t\tctx.save();\r\n\t\tctx.resetTransform();\r\n\t\t\r\n\t\tconst p = getIJ(0,0);\r\n\t\tctx.fillText(\"0\",p.i,p.j);\r\n\t\t\r\n\t\tconst p1 = getIJ(1,0);\r\n\t\tctx.fillText(\"1\",p1.i,p1.j);\r\n\t\t\r\n\t\tctx.restore();\r\n\t\t*/\r\n\t\t\r\n\t\t//移動中表示用の画像保存\r\n\t\timage.src = canvas.toDataURL();\r\n\t\t\r\n\t\t//情報表示\r\n\t\tinfo();\r\n\t};\r\n\t\r\n\tupdate();\r\n};","/*\r\n\tColorbar\r\n\t2020/11/01 新規作成\r\n*/\r\n\r\nconst HEX2RGB = function(c){\r\n\tconst r = (c & 0xff0000) >> 16;\r\n\tconst g = (c & 0x00ff00) >> 8;\r\n\tconst b = c & 0x0000ff;\r\n\treturn {r,g,b};\r\n};\r\n\r\nmodule.exports = function(min,max,colors){\r\n\t\r\n\tconst n = colors.length;\r\n\tconst dx = (max - min) / (n - 1);\r\n\t\r\n\tconst interpolate = function(x,x0,y0,x1,y1){\r\n\t\treturn (x - x0) * (y1 - y0) / (x1 - x0) + y0;\r\n\t}\r\n\t\r\n\tthis.get = function(x){\r\n\t\tif(x <= min) return HEX2RGB(colors[0]);\r\n\t\tif(x >= max) return HEX2RGB(colors[n-1]);\r\n\t\t\r\n\t\tconst i = Math.floor((x - min) / dx);\r\n\t\tconst x0 = min + i * dx;\r\n\t\tconst c0 = HEX2RGB(colors[i]);\r\n\t\tconst c1 = HEX2RGB(colors[i+1]);\r\n\t\t\r\n\t\tconst r = interpolate(x,x0,c0.r,x0 + dx,c1.r);\r\n\t\tconst g = interpolate(x,x0,c0.g,x0 + dx,c1.g);\r\n\t\tconst b = interpolate(x,x0,c0.b,x0 + dx,c1.b);\r\n\t\treturn {r,g,b};\r\n\t};\r\n};\r\n","/*\r\n\tマンデルブロ集合\r\n\t2020/10/25 新規作成\r\n*/\r\n\r\nconst Colorbar = require(\"./Colorbar.js\");\r\n\r\nconst md = function(x,y){\r\n\tlet xn = 0;\r\n\tlet yn = 0;\r\n\t\r\n\tfor(let i=0; i<256; i++){\r\n\t\tconst xn1 = xn * xn - yn * yn + x;\r\n\t\tconst yn1 = 2 * xn * yn + y;\r\n\t\txn = xn1;\r\n\t\tyn = yn1;\r\n\t\t\r\n\t\tif(xn * xn + yn * yn > 4) return 255 - i;\r\n\t}\r\n\t\r\n\treturn 0;\r\n};\r\n\r\n\r\nmodule.exports = function(ctx,width,height){\r\n\t//IJ座標からXY座標への変換行列\r\n\tconst m = ctx.getTransform().invertSelf();\r\n\t\r\n\tconst data = ctx.getImageData(0, 0, width, height);\r\n\t\r\n\tconst cb = new Colorbar(0,32,[0x000000,0xffff60,0xffffff,0x6060ff,0x000000]);\r\n\t\r\n\tfor(let j=0; j<height; j++){\r\n\t\tfor(let i=0; i<width; i++){\r\n\t\t\tconst index = (i + j * width) * 4;\r\n\t\t\t\r\n\t\t\tconst x = m.a * i + m.c * j + m.e;\r\n\t\t\tconst y = m.b * i + m.d * j + m.f;\r\n\t\t\tconst z = md(x,y);\r\n\t\t\t\r\n\t\t\tconst c = cb.get(z % 32);\r\n\t\t\t\r\n\t\t\tdata.data[index] = c.r; // R\r\n\t\t\tdata.data[index+1] = c.g; // G\r\n\t\t\tdata.data[index+2] = c.b; // B\r\n\t\t\tdata.data[index+3] = 255; // A\r\n\t\t}\r\n\t}\r\n\t\r\n\tctx.putImageData(data, 0, 0);\r\n};\r\n","/*\r\n\tmandelbrot\r\n\t2020/10/26 新規作成\r\n*/\r\n\r\nconst Viewer = require(\"./Viewer.js\");\r\nconst mandelbrot = require(\"./mandelbrot.js\");\r\n\r\nconst vw = new Viewer(document.getElementById(\"viewer\"),{\r\n\t\r\n\tx: {\r\n\t\tinit: -0.5,\r\n\t\tmin: -2,\r\n\t\tmax: 1,\r\n\t},\r\n\t\r\n\ty: {\r\n\t\tinit: 0.0,\r\n\t\tmin: -1.5,\r\n\t\tmax: 1.5,\r\n\t},\r\n\t\r\n\tscale: {\r\n\t\tinit: 100,\r\n\t\tmin: 100,\r\n\t\tmax: 200000000,\r\n\t},\r\n\r\n},function(ctx,width,height){\r\n\t\r\n\tmandelbrot(ctx,width,height);\r\n\t\r\n},function(str){\r\n\t\r\n\tdocument.getElementById(\"status\").innerHTML = str;\r\n\t\r\n});\r\n"]}